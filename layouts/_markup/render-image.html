{{- /*
Renders the image based on the provided image path.

The path can be provided in different ways:

- From the `static` folder:
  ![Image alt](img/icons/quote.svg)

- From any folder inside the `content` directory:
  ![Image alt](/docs/resources/books/ddd-design.png)

- From the current page folder:
  ![Image alt](ddd-design.png)

By default, each image will be rendered with `lazy` loading.
To change this, add `"loading=eager"` as follows:
![Image alt](ddd-design.png "loading=eager")

Also renders relative images for standard pages, not just for branch
bundle `_index.md` files.
*/ -}}

{{ $link := .Destination }}
{{ $loading := "lazy" }}

{{ if not (strings.HasPrefix $link "/") }}
    {{ $cleanedLink := replaceRE "#.*$" "" $link }}
    {{ $resource := .Page.Resources.GetMatch $cleanedLink }}

    {{ if not $resource }}
        {{ with .Page.CurrentSection }}
            {{ $resource = .Resources.GetMatch $cleanedLink }}
        {{ end }}
    {{ end }}

    {{ if $resource }}
        {{ $link = $resource.RelPermalink }}
    {{ else }}
        {{ $link = $link | relURL }}
    {{ end }}
{{ end }}

{{ if (eq .Title "loading=eager") }}
    {{ $loading = "eager" }}
{{ end }}

<img src="{{ $link }}" alt="{{ .Text }}" loading="{{ $loading }}"/>
{{- /* Strip trailing newline. */ -}}
